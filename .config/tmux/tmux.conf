# tmux configs

# Set coorect $TERM value
set-option -g default-terminal "alacritty"

# fix delay time between tmux & vim
set-option -sg escape-time 0

# default shell
set-option -g default-command /bin/zsh
set-option -g default-shell /bin/zsh

# # Highlight active window.
# set -w -g window-status-current-bg red

# Don't wait for an escape sequence after seeing prefix
set -s escape-time 0

# Needed as on tmux 1.9 and up (defaults to off).
# Added in tmux commit c7a121cfc0137c907b7bfb.
set -g focus-events on

# But don't change tmux's own window titles.
set -w -g automatic-rename off

# Don't wrap searches; it's super confusing given tmux's reverse-ordering of
# position info in copy mode.
set -w -g wrap-search off



# Start a non-login shell
set -g default-command "${SHELL}"

## update the TERM variable of terminal emulator when creating a new session or attaching a existing session
# set -g update-environment 'DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY TERM'
## determine if we should enable 256-colour support
# if "[[ ${TERM} =~ 256color || ${TERM} == fbterm ]]" 'set -g default-terminal screen-256color'

# Prevents annoying activity popup
set -g visual-activity off

# Misc
set -g history-limit 102400
set -g repeat-time 500
set -g monitor-activity off
set -g mouse on
setw -g mode-keys vi

#===============================================================================
#                             Styles
#===============================================================================

#=======================================
#              Status
#=======================================

set-option -g status-position top
set-option -g status-justify left
set-option -g status-bg default
set-option -g status-fg white
set-option -g status-interval 60
set-option -g status-left-length 30

# set-option -g status-left '#[fg=magenta]» #[fg=blue,bold]#T#[default]'
set-option -g status-right '#[fg=red,bold][[ #(git branch) branch ]] #[fg=cyan]»» #[fg=blue,bold]###S #[fg=magenta]%R %m-%d#(acpi | cut -d ',' -f 2)#[default]'
# set -g status-left '#[fg=yellow]#S ⧉ '
# set -g status-right "#[fg=yellow]$USER@#h #[fg=magenta]%l:%M %p"

#=======================================
#              Pane Styles
#=======================================

set-option -g pane-border-status off
# set-option -g pane-border-format "#{pane_index} #{pane_current_command}"
# set-option -g pane-active-border-style fg=colour245
# set-option -g pane-border-style fg=colour243

#=======================================
#              Window Styles
#=======================================

# Dynamically update iTerm tab and window titles.
set -g set-titles on

# Index starts from 1
set -g base-index 1
set -g pane-base-index 1

# Renumber windows when a window is closed
set -g renumber-windows on

# Show bells in window titles.
set -g window-status-bell-style fg=yellow,bold,underscore

# #T      = standard window title (last command, see ~/.bash_profile)
# #h      = short hostname
# #S      = session name
# #W      = tmux window name
#
# (Would love to include #(pwd) here as well, but that would only print the
# current working directory relative to the session -- ie. always the starting
# cwd -- which is not very interesting).
set -g set-titles-string "#T : #h > #S > #W"

set-window-option -g window-status-format '#[bg=colour238]#[fg=colour107] #I #[bg=colour239]#[fg=colour110] #[bg=colour240]#W#[bg=colour239]#[fg=colour195]#F#[bg=colour238] '
set-window-option -g window-status-current-format '#[bg=colour236]#[fg=colour215] #I #[bg=colour235]#[fg=colour167] #[bg=colour234]#W#[bg=colour235]#[fg=colour195]#F#[bg=colour236] '

#===============================================================================
#                             Bindings
#===============================================================================

set -g prefix M-Space

#=======================================
#              Window Bindings
#=======================================

# # Spawn/Kill
# bind -n M-o new-window -c "#{pane_current_path}"
# bind -n M-n kill-window

# Navigation
bind -n M-j select-window -t :-
bind -n M-';' select-window -t :+

# Movings
bind-key -r > swap-window -d -t :+
bind-key -r < swap-window -d -t :-

#=======================================
#              Pane Bindings
#=======================================

# Spawn/Kill
bind -n M-o split-window -h -c "#{pane_current_path}"
bind -n M-n kill-pane

# Navigation
bind -n M-l select-pane -t :.+
bind -n M-k select-pane -t :.-
bind -n M-i rotate-window

#=======================================
#              Misc Bindings
#=======================================

# Toggle status
bind-key G set status

# Exit
# bind Escape detach-client

# bind -n M-o select-pane -t :.+ \; resize-pane -Z	# next pane in zoomed mode
# bind -n M-j select-pane -t :.+	# next pane

# bind -T prefix h list-keys -N
# bind -n S-F1 list-keys -N


# # Resize
# bind -r j resize-pane -L 5
# bind -r l resize-pane -D 5
# bind -r k resize-pane -U 5
# bind -r ';' resize-pane -R 5

# bind -T copy-mode-vi j send-keys -X cursor-left
# bind -T copy-mode-vi l send-keys -X cursor-down
# bind    -T copy-mode-vi l                    send-keys -X cursor-right

# bind-key -T copy-mode C-Up   send-keys -X scroll-up
# bind-key -T copy-mode C-Down send-keys -X scroll-down

# urlscan
bind-key u capture-pane \; \
  save-buffer /tmp/tmux-buffer \; \
  new-window 'urlscan -Hdcr "launch --link {}" < /tmp/tmux-buffer' \; \
  delete-buffer

# # y and p as in vim
# bind Escape copy-mode
# unbind p
# bind p paste-buffer
# bind-key -T copy-mode-vi 'v' send -X begin-selection
# bind-key -T copy-mode-vi 'y' send -X copy-selection
# bind-key -T copy-mode-vi 'Space' send -X halfpage-down
# k bind-key -T copy-mode-vi 'Bspace' send -X halfpage-up
#===============================================================================
#                             Plugins
#===============================================================================

# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# run -b '~/.tmux/plugins/tpm/tpm'

run-shell $GIT/others/tmux-continuum/continuum.tmux
run-shell $GIT/others/tmux-resurrect/resurrect.tmux
