# tmux configs

# Set coorect $TERM value
set -g default-terminal "alacritty"

# fix delay time between tmux & vim
set -sg escape-time 0

# default shell
set -g default-command /bin/zsh
set -g default-shell /bin/zsh

# # Highlight active window.
# set -w -g window-status-current-bg red

# Don't wait for an escape sequence after seeing prefix
set -s escape-time 0

# Needed as on tmux 1.9 and up (defaults to off).
# Added in tmux commit c7a121cfc0137c907b7bfb.
set -g focus-events on

# But don't change tmux's own window titles.
set -w -g automatic-rename off

# Don't wrap searches; it's super confusing given tmux's reverse-ordering of
# position info in copy mode.
set -w -g wrap-search off

# Start a non-login shell
set -g default-command "${SHELL}"

## update the TERM variable of terminal emulator when creating a new session or attaching a existing session
# set -g update-environment 'DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY TERM'
## determine if we should enable 256-colour support
# if "[[ ${TERM} =~ 256color || ${TERM} == fbterm ]]" 'set -g default-terminal screen-256color'

# Prevents annoying activity popup
set -g visual-activity off

# super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Misc
set -g history-limit 102400
set -g repeat-time 500
set -g monitor-activity off
set -g mouse on
setw -g mode-keys vi

#===============================================================================
#                             Styles
#===============================================================================

#=======================================
#              Status
#=======================================

set -g status-position top
set -g status-justify left
set -g status-bg default
set -g status-fg white
set -g status-interval 60
set -g status-left-length 30

# set-option -g status-left '#[fg=magenta]» #[fg=blue,bold]#T#[default]'
set -g status-right '#[fg=red,bold][[ #(git branch) branch ]] #[fg=cyan]»» #[fg=blue,bold]###S #[fg=magenta]%R %m-%d#(acpi | cut -d ',' -f 2)#[default]'
# set -g status-left '#[fg=yellow]#S ⧉ '
# set -g status-right "#[fg=yellow]$USER@#h #[fg=magenta]%l:%M %p"

#=======================================
#              Pane Styles
#=======================================

set -g pane-border-status off
set -g pane-border-format "#{pane_index} #{pane_current_command}"
set -g pane-active-border-style fg=red
set -g pane-border-style fg=white
# set -g pane-border-style fg=colour243

#=======================================
#              Window Styles
#=======================================

# Dynamically update iTerm tab and window titles.
set -g set-titles on

# Index starts from 1
set -g base-index 1
set -g pane-base-index 1

# Renumber windows when a window is closed
set -g renumber-windows on

# Show bells in window titles.
set -g window-status-bell-style fg=yellow,bold,underscore

# #T      = standard window title (last command, see ~/.bash_profile)
# #h      = short hostname
# #S      = session name
# #W      = tmux window name
#
# (Would love to include #(pwd) here as well, but that would only print the
# current working directory relative to the session -- ie. always the starting
# cwd -- which is not very interesting).
set -g set-titles-string "#T : #h > #S > #W"

setw -g window-status-format '#[bg=colour238]#[fg=colour107] #I #[bg=colour239]#[fg=colour110] #[bg=colour240]#W#[bg=colour239]#[fg=colour195]#F#[bg=colour238] '
setw -g window-status-current-format '#[bg=colour236]#[fg=colour215] #I #[bg=colour235]#[fg=colour167] #[bg=colour234]#W#[bg=colour235]#[fg=colour195]#F#[bg=colour236] '

#===============================================================================
#                             Bindings
#===============================================================================

set -g prefix M-Space

#=======================================
#              Pane Bindings
#=======================================

# # Spawn/Kill
# bind p split-window -h -c "#{pane_current_path}"
# bind -n M-o split-window -h -c "#{pane_current_path}" "bolt --fzf-search"
# bind P kill-pane
bind -n M-n kill-pane

# # Navigation
# bind j select-pane -t :.+
# bind ';' select-pane -t :.-
# # bind -n M-, rotate-window

# # Zoom
# bind -n M-m resize-pane -Z

# # Swapping
# bind -r K swap-pane -d -t :.+
# bind -r L swap-pane -d -t :.-

# # Resize
# bind -r J resize-pane -L 5
# bind -r L resize-pane -D 5
# bind -r K resize-pane -U 5
# bind -r ':' resize-pane -R 5

#=======================================
#              Window Bindings
#=======================================

# # Spawn/Kill
bind w new-window -c "#{pane_current_path}"
bind W kill-window

# Navigation
bind -n M-j   selectw -p
bind -n M-';' selectw -n

# Swapping
bind -r ';' swap-window -d -t :+
bind -r j   swap-window -d -t :-

#=======================================
#              Session Bindings
#=======================================

bind s new-session
bind -n M-Enter new-session
bind S kill-session
bind -n M-h switch-client -p \; kill-session -t :+

bind -n M-k switch-client -p
bind -n M-l switch-client -n

bind t choose-tree -Zs

#=======================================
#              Misc Bindings
#=======================================

# Toggle status
bind G set status

bind r command-prompt -I "#W" "rename-window -- '%%'"
bind R command-prompt -I "#S" "rename-session -- '%%'"

# Exit
bind Escape kill-server

# bind -n M-o select-pane -t :.+ \; resize-pane -Z	# next pane in zoomed mode
# bind -n M-j select-pane -t :.+	# next pane

# bind -T prefix h list-keys -N
# bind -n S-F1 list-keys -N



# bind -T copy-mode-vi j send-keys -X cursor-left
# bind -T copy-mode-vi l send-keys -X cursor-down
# bind    -T copy-mode-vi l                    send-keys -X cursor-right

# bind-key -T copy-mode C-Up   send-keys -X scroll-up
# bind-key -T copy-mode C-Down send-keys -X scroll-down

# # urlscan
# bind u capture-pane \; \
#   save-buffer /tmp/tmux-buffer \; \
#   new-window 'urlscan -Hdcr "launch --link {}" < /tmp/tmux-buffer' \; \
#   delete-buffer

# urlscan
bind u capture-pane \; \
  save-buffer /tmp/tmux-buffer \; \
  new-window 'fzf-url < /tmp/tmux-buffer' \; \
  delete-buffer

# # y and p as in vim
# bind Escape copy-mode
# unbind p
# bind p paste-buffer
# bind-key -T copy-mode-vi 'v' send -X begin-selection
# bind-key -T copy-mode-vi 'y' send -X copy-selection
# bind-key -T copy-mode-vi 'Space' send -X halfpage-down
# k bind-key -T copy-mode-vi 'Bspace' send -X halfpage-up

bind g select-window -T

#===============================================================================
#                             Plugins
#===============================================================================

# Resurrect
run-shell $GIT/others/tmux-resurrect/resurrect.tmux
set -g @resurrect-processes ':all:'
set -g @resurrect-dir '~/.local/share/tmux/resurrect'

bind -n M-s run-shell $GIT/others/tmux-resurrect/scripts/save.sh
bind -n M-r run-shell $GIT/others/tmux-resurrect/scripts/restore.sh
